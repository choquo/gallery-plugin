!function(t){function i(t,i,e){var s=parseInt(t.css("top"),10);if("left"==i){var n="-"+this.image_wrapper_height+"px";t.css("top",this.image_wrapper_height+"px")}else{var n=this.image_wrapper_height+"px";t.css("top","-"+this.image_wrapper_height+"px")}return e&&(e.css("bottom","-"+e[0].offsetHeight+"px"),e.animate({bottom:0},2*this.settings.animation_speed)),this.current_description&&this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},2*this.settings.animation_speed),{old_image:{top:n},new_image:{top:s}}}function e(t,i,e){var s=parseInt(t.css("left"),10);if("left"==i){var n="-"+this.image_wrapper_width+"px";t.css("left",this.image_wrapper_width+"px")}else{var n=this.image_wrapper_width+"px";t.css("left","-"+this.image_wrapper_width+"px")}return e&&(e.css("bottom","-"+e[0].offsetHeight+"px"),e.animate({bottom:0},2*this.settings.animation_speed)),this.current_description&&this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},2*this.settings.animation_speed),{old_image:{left:n},new_image:{left:s}}}function s(t,i,e){var s=t.width(),n=t.height(),a=parseInt(t.css("left"),10),h=parseInt(t.css("top"),10);return t.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2}),{old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:s,height:n,top:h,left:a}}}function n(t,i,e){return t.css("opacity",0),{old_image:{opacity:0},new_image:{opacity:1}}}function a(t,i,e){return t.css("opacity",0),{old_image:{opacity:0},new_image:{opacity:1},speed:0}}function h(t,i){this.init(t,i)}function r(t,i){this.init(t,i)}t.fn.adGallery=function(i){var e={loader_image:"gallery-plugin/lib/loader.gif",start_at_index:0,update_window_hash:!0,description_wrapper:!1,thumb_opacity:.7,animate_first_image:!1,animation_speed:400,width:!1,height:!1,display_next_and_prev:!0,display_back_and_forward:!0,scroll_jump:0,slideshow:{enable:!0,autostart:!1,speed:5e3,start_label:"Start",stop_label:"Stop",stop_on_scroll:!0,countdown_prefix:"(",countdown_sufix:")",onStart:!1,onStop:!1},effect:"slide-hori",enable_keyboard_move:!0,cycle:!0,hooks:{displayDescription:!1},callbacks:{init:!1,afterImageVisible:!1,beforeImageVisible:!1}},s=t.extend(!1,e,i);i&&i.slideshow&&(s.slideshow=t.extend(!1,e.slideshow,i.slideshow)),s.slideshow.enable||(s.slideshow.autostart=!1);var n=[];return t(this).each(function(){var t=new h(this,s);n[n.length]=t}),n},h.prototype={wrapper:!1,image_wrapper:!1,gallery_info:!1,nav:!1,loader:!1,preloads:!1,thumbs_wrapper:!1,thumbs_wrapper_width:0,scroll_back:!1,scroll_forward:!1,next_link:!1,prev_link:!1,slideshow:!1,image_wrapper_width:0,image_wrapper_height:0,current_index:-1,current_image:!1,current_description:!1,nav_display_width:0,settings:!1,images:!1,in_transition:!1,animations:!1,init:function(i,e){var s=this;this.wrapper=t(i),this.settings=e,this.setupElements(),this.setupAnimations(),this.settings.width?(this.image_wrapper_width=this.settings.width,this.image_wrapper.width(this.settings.width),this.wrapper.width(this.settings.width)):this.image_wrapper_width=this.image_wrapper.width(),this.settings.height?(this.image_wrapper_height=this.settings.height,this.image_wrapper.height(this.settings.height)):this.image_wrapper_height=this.image_wrapper.height(),this.nav_display_width=this.nav.width(),this.current_index=-1,this.current_image=!1,this.current_description=!1,this.in_transition=!1,this.findImages(),this.settings.display_next_and_prev&&this.initNextAndPrev();var n=function(t){return s.nextImage(t)};this.slideshow=new r(n,this.settings.slideshow),this.controls.append(this.slideshow.create()),this.settings.slideshow.enable?this.slideshow.enable():this.slideshow.disable(),this.settings.display_back_and_forward&&this.initBackAndForward(),this.settings.enable_keyboard_move&&this.initKeyEvents(),this.initHashChange();var a=parseInt(this.settings.start_at_index,10);"undefined"!=typeof this.getIndexFromHash()&&(a=this.getIndexFromHash()),this.loading(!0),this.showImage(a,function(){s.settings.slideshow.autostart&&(s.preloadImage(a+1),s.slideshow.start())}),this.fireCallback(this.settings.callbacks.init)},setupAnimations:function(){this.animations={"slide-vert":i,"slide-hori":e,resize:s,fade:n,none:a}},setupElements:function(){this.controls=this.wrapper.find(".gp-controls"),this.gallery_info=t('<p class="gp-info"></p>'),this.controls.append(this.gallery_info),this.image_wrapper=this.wrapper.find(".gp-image-wrapper"),this.image_wrapper.empty(),this.nav=this.wrapper.find(".gp-nav"),this.thumbs_wrapper=this.nav.find(".gp-thumbs"),this.preloads=t('<div class="gp-preloads"></div>'),this.loader=t('<img class="gp-loader" src="'+this.settings.loader_image+'">'),this.image_wrapper.append(this.loader),this.loader.hide(),t(document.body).append(this.preloads)},loading:function(t){t?this.loader.show():this.loader.hide()},addAnimation:function(i,e){t.isFunction(e)&&(this.animations[i]=e)},findImages:function(){var i=this;this.images=[];var e=0,s=this.thumbs_wrapper.find("a"),n=s.length;this.settings.thumb_opacity<1&&s.find("img").css("opacity",this.settings.thumb_opacity),s.each(function(s){var n=t(this);n.data("gp-i",s);var a=n.attr("href"),h=n.find("img");i.whenImageLoaded(h[0],function(){var t=h[0].parentNode.parentNode.offsetWidth;0==h[0].width&&(t=100),i.thumbs_wrapper_width+=t,e++}),i._initLink(n),i.images[s]=i._createImageData(n,a)});var a=setInterval(function(){n==e&&(i._setThumbListWidth(i.thumbs_wrapper_width),clearInterval(a))},100)},_setThumbListWidth:function(t){t-=100;var i=this.nav.find(".gp-thumb-list");i.css("width",t+"px");for(var e=1,s=i.height();201>e&&(i.css("width",t+e+"px"),s==i.height());)s=i.height(),e++;i.width()<this.nav.width()&&i.width(this.nav.width())},_initLink:function(i){var e=this;i.click(function(){return e.showImage(i.data("gp-i")),e.slideshow.stop(),!1}).hover(function(){!t(this).is(".gp-active")&&e.settings.thumb_opacity<1&&t(this).find("img").fadeTo(300,1),e.preloadImage(i.data("gp-i"))},function(){!t(this).is(".gp-active")&&e.settings.thumb_opacity<1&&t(this).find("img").fadeTo(300,e.settings.thumb_opacity)})},_createImageData:function(t,i){var e=!1,s=t.find("img");s.data("gp-link")?e=t.data("gp-link"):s.attr("longdesc")&&s.attr("longdesc").length&&(e=s.attr("longdesc"));var n=!1;s.data("gp-desc")?n=s.data("gp-desc"):s.attr("alt")&&s.attr("alt").length&&(n=s.attr("alt"));var a=!1;return s.data("gp-title")?a=s.data("gp-title"):s.attr("title")&&s.attr("title").length&&(a=s.attr("title")),{thumb_link:t,image:i,error:!1,preloaded:!1,desc:n,title:a,size:!1,link:e}},initKeyEvents:function(){var i=this;t(document).keydown(function(t){39==t.keyCode?(i.nextImage(),i.slideshow.stop()):37==t.keyCode&&(i.prevImage(),i.slideshow.stop())})},getIndexFromHash:function(){if(window.location.hash&&0===window.location.hash.indexOf("#gp-image-")){var t=window.location.hash.replace(/^#gp-image-/g,""),i=this.thumbs_wrapper.find("#"+t);if(i.length)return this.thumbs_wrapper.find("a").index(i);if(!isNaN(parseInt(t,10)))return parseInt(t,10)}},removeImage:function(i){if(0>i||i>=this.images.length)throw"Cannot remove image for index "+i;var e=this.images[i];this.images.splice(i,1);var s=e.thumb_link,n=s[0].parentNode.offsetWidth;this.thumbs_wrapper_width-=n,s.remove(),this._setThumbListWidth(this.thumbs_wrapper_width),this.gallery_info.html(this.current_index+1+" / "+this.images.length),this.thumbs_wrapper.find("a").each(function(i){t(this).data("gp-i",i)}),i==this.current_index&&0!=this.images.length&&this.showImage(0)},removeAllImages:function(){for(var t=this.images.length-1;t>=0;t--)this.removeImage(t)},addImage:function(i,e,s,n,a){s=s||"",n=n||"",a=a||"";var h=t('<li><a href="'+e+'" id="'+s+'"><img src="'+i+'" title="'+n+'" alt="'+a+'"></a></li>'),r=this;this.thumbs_wrapper.find("ul").append(h);var o=h.find("a"),d=o.find("img");d.css("opacity",this.settings.thumb_opacity),this.whenImageLoaded(d[0],function(){var t=d[0].parentNode.parentNode.offsetWidth;0==d[0].width&&(t=100),r.thumbs_wrapper_width+=t,r._setThumbListWidth(r.thumbs_wrapper_width)});var p=this.images.length;o.data("gp-i",p),this._initLink(o),this.images[p]=r._createImageData(o,e),this.gallery_info.html(this.current_index+1+" / "+this.images.length)},initHashChange:function(){var i=this;if("onhashchange"in window)t(window).bind("hashchange",function(){var t=i.getIndexFromHash();"undefined"!=typeof t&&t!=i.current_index&&i.showImage(t)});else{var e=window.location.hash;setInterval(function(){if(window.location.hash!=e){e=window.location.hash;var t=i.getIndexFromHash();"undefined"!=typeof t&&t!=i.current_index&&i.showImage(t)}},200)}},initNextAndPrev:function(){this.next_link=t('<div class="gp-next"><div class="gp-next-image"></div></div>'),this.prev_link=t('<div class="gp-prev"><div class="gp-prev-image"></div></div>'),this.image_wrapper.append(this.next_link),this.image_wrapper.append(this.prev_link);var i=this;this.prev_link.add(this.next_link).mouseover(function(e){t(this).css("height",i.image_wrapper_height),t(this).find("div").show()}).mouseout(function(i){t(this).find("div").hide()}).click(function(){t(this).is(".gp-next")?(i.nextImage(),i.slideshow.stop()):(i.prevImage(),i.slideshow.stop())}).find("div").css("opacity",.7)},initBackAndForward:function(){var i=this;this.scroll_forward=t('<div class="gp-forward"></div>'),this.scroll_back=t('<div class="gp-back"></div>'),this.nav.append(this.scroll_forward),this.nav.prepend(this.scroll_back);var e=0,s=!1;t(this.scroll_back).add(this.scroll_forward).click(function(){var e=i.nav_display_width-50;if(i.settings.scroll_jump>0)var e=i.settings.scroll_jump;if(t(this).is(".gp-forward"))var s=i.thumbs_wrapper.scrollLeft()+e;else var s=i.thumbs_wrapper.scrollLeft()-e;return i.settings.slideshow.stop_on_scroll&&i.slideshow.stop(),i.thumbs_wrapper.animate({scrollLeft:s+"px"}),!1}).css("opacity",.6).hover(function(){var n="left";t(this).is(".gp-forward")&&(n="right"),s=setInterval(function(){e++,e>30&&i.settings.slideshow.stop_on_scroll&&i.slideshow.stop();var t=i.thumbs_wrapper.scrollLeft()+1;"left"==n&&(t=i.thumbs_wrapper.scrollLeft()-1),i.thumbs_wrapper.scrollLeft(t)},10),t(this).css("opacity",1)},function(){e=0,clearInterval(s),t(this).css("opacity",.6)})},_afterShow:function(){if(this.gallery_info.html(this.current_index+1+" / "+this.images.length),this.settings.cycle||(this.prev_link.show().css("height",this.image_wrapper_height),this.next_link.show().css("height",this.image_wrapper_height),this.current_index==this.images.length-1&&this.next_link.hide(),0==this.current_index&&this.prev_link.hide()),this.settings.update_window_hash){var t=this.images[this.current_index].thumb_link;t.attr("id")?window.location.hash="#gp-image-"+t.attr("id"):window.location.hash="#gp-image-"+this.current_index}this.fireCallback(this.settings.callbacks.afterImageVisible)},_getContainedImageSize:function(t,i){if(i>this.image_wrapper_height){var e=t/i;i=this.image_wrapper_height,t=this.image_wrapper_height*e}if(t>this.image_wrapper_width){var e=i/t;t=this.image_wrapper_width,i=this.image_wrapper_width*e}return{width:t,height:i}},_centerImage:function(t,i,e){if(t.css("top","0px"),e<this.image_wrapper_height){var s=this.image_wrapper_height-e;t.css("top",s/2+"px")}if(t.css("left","0px"),i<this.image_wrapper_width){var s=this.image_wrapper_width-i;t.css("left",s/2+"px")}},_getDescription:function(i){var e=!1;if(i.desc.length||i.title.length){var s="";i.title.length&&(s='<strong class="gp-description-title">'+i.title+"</strong>");var e="";i.desc.length&&(e="<span>"+i.desc+"</span>"),e=t('<p class="gp-image-description">'+s+e+"</p>")}return e},showImage:function(t,i){if(this.images[t]&&!this.in_transition&&t!=this.current_index){var e=this,s=this.images[t];this.in_transition=!0,s.preloaded?this._showWhenLoaded(t,i):(this.loading(!0),this.preloadImage(t,function(){e.loading(!1),e._showWhenLoaded(t,i)}))}},_showWhenLoaded:function(i,e){if(this.images[i]){var s=this,n=this.images[i],a=t(document.createElement("div")).addClass("gp-image"),h=t(new Image).attr("src",n.image);if(n.link){var r=t('<a href="'+n.link+'" target="_blank"></a>');r.append(h),a.append(r)}else a.append(h);this.image_wrapper.prepend(a);var o=this._getContainedImageSize(n.size.width,n.size.height);h.attr("width",o.width),h.attr("height",o.height),a.css({width:o.width+"px",height:o.height+"px"}),this._centerImage(a,o.width,o.height);var d=this._getDescription(n);if(d)if(this.settings.description_wrapper||this.settings.hooks.displayDescription)if(this.settings.hooks.displayDescription)this.settings.hooks.displayDescription.call(this,n);else{var p=this.settings.description_wrapper;p.append(d)}else{a.append(d);var l=o.width-parseInt(d.css("padding-left"),10)-parseInt(d.css("padding-right"),10);d.css("width",l+"px")}this.highLightThumb(this.images[i].thumb_link);var g="right";if(this.current_index<i&&(g="left"),this.fireCallback(this.settings.callbacks.beforeImageVisible),this.current_image||this.settings.animate_first_image){var c=this.settings.animation_speed,_="swing",m=this.animations[this.settings.effect].call(this,a,g,d);if("undefined"!=typeof m.speed&&(c=m.speed),"undefined"!=typeof m.easing&&(_=m.easing),this.current_image){var f=this.current_image,w=this.current_description;f.animate(m.old_image,c,_,function(){f.remove(),w&&w.remove()})}a.animate(m.new_image,c,_,function(){s.current_index=i,s.current_image=a,s.current_description=d,s.in_transition=!1,s._afterShow(),s.fireCallback(e)})}else this.current_index=i,this.current_image=a,s.current_description=d,this.in_transition=!1,s._afterShow(),this.fireCallback(e)}},nextIndex:function(){if(this.current_index==this.images.length-1){if(!this.settings.cycle)return!1;var t=0}else var t=this.current_index+1;return t},nextImage:function(t){var i=this.nextIndex();return i===!1?!1:(this.preloadImage(i+1),this.showImage(i,t),!0)},prevIndex:function(){if(0==this.current_index){if(!this.settings.cycle)return!1;var t=this.images.length-1}else var t=this.current_index-1;return t},prevImage:function(t){var i=this.prevIndex();return i===!1?!1:(this.preloadImage(i-1),this.showImage(i,t),!0)},preloadAll:function(){function t(){e<i.images.length&&(e++,i.preloadImage(e,t))}var i=this,e=0;i.preloadImage(e,t)},preloadImage:function(i,e){if(this.images[i]){var s=this.images[i];if(this.images[i].preloaded)this.fireCallback(e);else{var n=t(new Image);if(n.attr("src",s.image),this.isImageLoaded(n[0]))s.preloaded=!0,s.size={width:n[0].width,height:n[0].height},this.fireCallback(e);else{this.preloads.append(n);var a=this;n.load(function(){s.preloaded=!0,s.size={width:this.width,height:this.height},a.fireCallback(e)}).error(function(){s.error=!0,s.preloaded=!1,s.size=!1})}}}},whenImageLoaded:function(i,e){this.isImageLoaded(i)?e&&e():t(i).load(e)},isImageLoaded:function(t){return"undefined"==typeof t.complete||t.complete?"undefined"==typeof t.naturalWidth||0!=t.naturalWidth:!1},highLightThumb:function(t){this.thumbs_wrapper.find(".gp-active").removeClass("gp-active"),t.addClass("gp-active"),this.settings.thumb_opacity<1&&(this.thumbs_wrapper.find("a:not(.gp-active) img").fadeTo(300,this.settings.thumb_opacity),t.find("img").fadeTo(300,1));var i=t[0].parentNode.offsetLeft;i-=this.nav_display_width/2-t[0].offsetWidth/2,this.thumbs_wrapper.animate({scrollLeft:i+"px"})},fireCallback:function(i){t.isFunction(i)&&i.call(this)}},r.prototype={start_link:!1,stop_link:!1,countdown:!1,controls:!1,settings:!1,nextimage_callback:!1,enabled:!1,running:!1,countdown_interval:!1,init:function(t,i){this.nextimage_callback=t,this.settings=i},create:function(){this.start_link=t('<span class="gp-slideshow-start">'+this.settings.start_label+"</span>"),this.stop_link=t('<span class="gp-slideshow-stop">'+this.settings.stop_label+"</span>"),this.countdown=t('<span class="gp-slideshow-countdown"></span>'),this.controls=t('<div class="gp-slideshow-controls"></div>'),this.controls.append(this.start_link).append(this.stop_link).append(this.countdown),this.countdown.hide();var i=this;return this.start_link.click(function(){i.start()}),this.stop_link.click(function(){i.stop()}),t(document).keydown(function(t){83==t.keyCode&&(i.running?i.stop():i.start())}),this.controls},disable:function(){this.enabled=!1,this.stop(),this.controls.hide()},enable:function(){this.enabled=!0,this.controls.show()},toggle:function(){this.enabled?this.disable():this.enable()},start:function(){if(this.running||!this.enabled)return!1;return this.running=!0,this.controls.addClass("gp-slideshow-running"),this._next(),this.fireCallback(this.settings.onStart),!0},stop:function(){return this.running?(this.running=!1,this.countdown.hide(),this.controls.removeClass("gp-slideshow-running"),clearInterval(this.countdown_interval),this.fireCallback(this.settings.onStop),!0):!1},_next:function(){var t=this,i=this.settings.countdown_prefix,e=this.settings.countdown_sufix;clearInterval(t.countdown_interval),this.countdown.show().html(i+this.settings.speed/1e3+e);var s=0;this.countdown_interval=setInterval(function(){if(s+=1e3,s>=t.settings.speed){var n=function(){t.running&&t._next(),s=0};t.nextimage_callback(n)||t.stop(),s=0}var a=parseInt(t.countdown.text().replace(/[^0-9]/g,""),10);a--,a>0&&t.countdown.html(i+a+e)},1e3)},fireCallback:function(i){t.isFunction(i)&&i.call(this)}}}(jQuery);